{% extends "core/_base.html" %}
{% block title %}Espécies da Competição • Equipe Nabos{% endblock %}

{% block content %}
<section class="mb-8">
  <div class="rounded-3xl border border-zinc-800 bg-zinc-950/60 p-6 md:p-8 relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-black/70 via-black/30 to-transparent"></div>

    <div class="relative flex flex-col md:flex-row md:items-end md:justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-semibold">Espécies de Competição</h1>
        <p class="text-zinc-300 text-sm mt-2 max-w-2xl">
          Lista oficial do que conta no ranking. Clique em uma espécie para abrir o perfil.
        </p>
      </div>

      <form method="get" class="w-full md:w-auto">
        <div class="flex gap-2">
          <input name="q" value="{{ q|default:'' }}"
                 placeholder="Buscar espécie..."
                 class="w-full md:w-72 rounded-2xl border border-zinc-800 bg-zinc-950/40 px-4 py-3 text-sm outline-none
                        focus:ring-2 focus:ring-zinc-600 focus:border-zinc-700" />
          <button class="rounded-2xl bg-white text-zinc-900 font-medium px-5 py-3 hover:opacity-90 transition">
            Buscar
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="grid gap-3 grid-cols-2 sm:grid-cols-4 mb-6">
  <div class="rounded-2xl border border-zinc-800 bg-zinc-900/35 p-4">
    <div class="text-xs text-zinc-400">Espécies</div>
    <div class="mt-1 text-xl font-semibold">{{ species_list|length }}</div>
  </div>
  <div class="rounded-2xl border border-zinc-800 bg-zinc-900/35 p-4">
    <div class="text-xs text-zinc-400">Busca</div>
    <div class="mt-1 text-sm text-zinc-200 truncate">
      {% if q %}“{{ q }}”{% else %}—{% endif %}
    </div>
  </div>
  <div class="rounded-2xl border border-zinc-800 bg-zinc-900/35 p-4">
    <div class="text-xs text-zinc-400">Regras</div>
    <div class="mt-1 text-sm text-zinc-200">Mínimo + pts/cm</div>
  </div>
  <div class="rounded-2xl border border-zinc-800 bg-zinc-900/35 p-4">
    <div class="text-xs text-zinc-400">Ranking</div>
    <div class="mt-1 text-sm text-zinc-200">Somente válidas</div>
  </div>
</section>

<section class="grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-4">
  {% for s in species_list %}
    <a href="{% url 'species_detail' s.slug %}"
       class="group rounded-3xl border border-zinc-800 bg-zinc-950/50 overflow-hidden
              hover:bg-zinc-900/60 transition shadow-sm">

      <!-- IMAGEM (topo) -->
      <div class="relative">
        <div class="aspect-[4/3] bg-zinc-900 overflow-hidden">
          {% with photo=s.photos.all.0 %}
            {% if photo and photo.image %}
              <img src="{{ photo.image.url }}"
                   class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                   alt="{{ s.name }}">
            {% elif s.image_url %}
              <img src="{{ s.image_url }}"
                   class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                   alt="{{ s.name }}">
            {% else %}
              <div class="w-full h-full flex items-center justify-center text-zinc-500 text-sm">
                Sem foto
              </div>
            {% endif %}
          {% endwith %}
        </div>

        <!-- SELINHOS (min / pts) -->
        <div class="absolute top-3 left-3 flex flex-wrap gap-2">
          <span class="rounded-full bg-black/60 backdrop-blur px-3 py-1 text-[11px] text-zinc-100 border border-white/10">
            Mín {{ s.min_length_cm|floatformat:0 }} cm
          </span>
          <span class="rounded-full bg-black/60 backdrop-blur px-3 py-1 text-[11px] text-zinc-100 border border-white/10">
            {{ s.points_per_cm|floatformat:0 }} pts/cm
          </span>
        </div>

        <!-- “COMPORTAMENTO” (estilo Windy) -->
        <div class="absolute bottom-3 left-3 right-3">
          {% comment %}
            Regra simples (ajuste do jeito que você quiser):
            - Se tem best_times => "Agressivo"
            - Se não tem => "Ativo"
            - Se não tem summary e best_times => "Manhoso"
          {% endcomment %}
          {% if s.best_times %}
            <div class="w-full rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200
                        text-center text-xs font-semibold py-2">
              Comportamento: Agressivo
            </div>
          {% elif s.summary %}
            <div class="w-full rounded-full bg-yellow-500/20 border border-yellow-400/30 text-yellow-200
                        text-center text-xs font-semibold py-2">
              Comportamento: Ativo
            </div>
          {% else %}
            <div class="w-full rounded-full bg-red-500/20 border border-red-400/30 text-red-200
                        text-center text-xs font-semibold py-2">
              Comportamento: Manhoso
            </div>
          {% endif %}
        </div>
      </div>

      <!-- CONTEÚDO -->
      <div class="p-4">
        <div class="flex items-start justify-between gap-2">
          <div class="min-w-0">
            <div class="font-semibold truncate">{{ s.name }}</div>
            <div class="text-xs text-zinc-400 truncate mt-0.5">
              {% if s.scientific_name %}{{ s.scientific_name }}{% else %}&nbsp;{% endif %}
            </div>
          </div>
          <span class="text-zinc-500 group-hover:text-white transition text-sm">›</span>
        </div>

        <!-- mini “ícones” (tipo Windy) -->
        <div class="mt-3 grid grid-cols-3 gap-2">
          {% for b in s.bait_ideas.all|slice:":3" %}
            <div class="rounded-2xl border border-zinc-800 bg-zinc-900/40 px-2 py-2 text-center">
              <div class="text-[11px] text-zinc-300 truncate">{{ b.bait_name }}</div>
            </div>
          {% empty %}
            <div class="col-span-3 rounded-2xl border border-zinc-800 bg-zinc-900/30 px-3 py-2 text-center text-[11px] text-zinc-400">
              Iscas em atualização
            </div>
          {% endfor %}
        </div>

        <!-- resumo curtinho -->
        <div class="mt-3 text-xs text-zinc-400 line-clamp-2">
          {% if s.summary %}{{ s.summary }}{% else %}Perfil em atualização.{% endif %}
        </div>

        <!-- rodapé -->
        <div class="mt-3 flex items-center justify-between text-xs text-zinc-500">
          <span class="truncate">{% if s.best_times %}{{ s.best_times }}{% else %}&nbsp;{% endif %}</span>
          <span class="text-zinc-300 group-hover:text-white transition">Ver</span>
        </div>
      </div>
    </a>
  {% empty %}
    <div class="rounded-2xl border border-zinc-800 bg-zinc-900/40 p-6 text-zinc-400">
      Ainda não há espécies cadastradas para a competição.
    </div>
  {% endfor %}
</section>


<style>
  .line-clamp-2{
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }
</style>

{% endblock %}
